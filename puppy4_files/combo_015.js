YUI.add("flickr-galleries-getPhotos-fetcher",function(e){"use strict";function t(t){var n={gallery_id:t.compoundId,extras:e.APIHelper.request.getRebootPhotoExtras(),per_page:t.perPage||1,page:t.page||20,get_user_info:1,get_gallery_info:1,primary_photo_extras:"url_sq, url_t, url_s, url_m"};return n}function n(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f;if(r&&r.gallery)return r.gallery.owner=r.user,r.gallery.title=r.gallery.title&&r.gallery.title.content,r.gallery.description=r.gallery.description&&r.gallery.description.content,r.gallery.photoCount=r.gallery.countPhotos,r.gallery.videoCount=r.gallery.countVideos,e.APIHelper.response.addContextToRegistry(r.gallery,o,s),f=e.APIHelper.response.parsePhotos({photos:r.photos.photo,personModelRegistry:s,photoModelRegistry:i,photoEngagementModelRegistry:u,photoStatsModelRegistry:a}),o.setValue(n.id,"photoPageList",f),f}function r(t,n){var r=this;return e.batch(n.callAPI("flickr.galleries.getPhotos",this._processParams(t),!0),n.getModelRegistry("photo-models"),n.getModelRegistry("person-models"),n.getModelRegistry("gallery-models"),n.getModelRegistry("photo-engagement-models"),n.getModelRegistry("photo-stats-models")).then(function(e){return r._processResponse(e,t)},function(e){throw n[e.fatal?"error":"debug"]("[flickr-galleries-getPhotos-fetcher] failed getting or processing API response:",e),e})}e.namespace("ListFetchers")["flickr-galleries-getPhotos"]={run:r,_processResponse:n,_processParams:t}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models","person-models","gallery-models","photo-engagement-models","photo-stats-models"]});
YUI.add("flickr-galleries-getContext-fetcher",function(e){"use strict";function t(t){var n={gallery_id:t.compoundId,photo_id:t.photoId,extras:e.APIHelper.request.getRebootPhotoExtras(),num_prev:t.numPrev,num_next:t.numNext};return n}function n(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=[],l=[],c=s.proxy(n.photoId),h,p,d,v,m,g,y=[];return h=r.nextphotos,p=r.prevphotos,l=e.APIHelper.response.parsePhotos({photos:h.photo,personModelRegistry:o,photoModelRegistry:s,photoEngagementModelRegistry:u,photoStatsModelRegistry:a}),f=e.APIHelper.response.parsePhotos({photos:p.photo,personModelRegistry:o,photoModelRegistry:s,photoEngagementModelRegistry:u,photoStatsModelRegistry:a}),g=i.getValue(n.id,"photoContextList"),v=g.hasMinBoundary?g.hasMinBoundary():!1,m=g.hasMaxBoundary?g.hasMaxBoundary():!1,d=g.getList(),y=e.APIHelper.response.addOrReplaceListByContext({model:c,next:l,prev:f.reverse(),current:d,hasMin:v,hasMax:m,numNext:n.numNext,numPrev:n.numPrev}),i.setValue(n.id,"photoContextList",y),{next:l,previous:f.reverse()}}function r(t,n){var r=this;return e.batch(n.callAPI("flickr.galleries.getContext",this._processParams(t),!0),n.getModelRegistry("gallery-models"),n.getModelRegistry("photo-models"),n.getModelRegistry("person-models"),n.getModelRegistry("photo-engagement-models"),n.getModelRegistry("photo-stats-models")).then(function(e){return r._processResponse(e,t)},function(e){throw n[e.fatal?"error":"debug"]("[flickr-galleries-getContext-fetcher] failed getting or processing API response:",e),e.code===3&&e.message==="Photo not in gallery"&&(e.notInContext=!0),e})}e.namespace("ListFetchers")["flickr-galleries-getContext"]={run:r,_processParams:t,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["gallery-models","photo-models","person-models","photo-engagement-models","photo-stats-models"]});
YUI.add("photo-galleries-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getAllContexts"].run(t,this.appContext)}},attributes:{id:{},galleries:{isListProxy:!0},total:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0}}})},"@VERSION@",{requires:["api-helper","flickr-model-registry","flickr-promise","flickr-photos-getAllContexts-fetcher"]});
YUI.add("flickr-galleries-addPhoto-creator",function(e){"use strict";function t(t,n){var r={},i=t.galleryCompoundID.split("-")[1];return r.photo_id=t.photoID,r.gallery_id=t.galleryCompoundID,e.batch(n.callAPI("flickr.galleries.addPhoto",r),n.getModel("gallery-models",i),n.getModel("photo-models",t.photoID),n.getModelRegistry("photo-galleries-models"),n.getModelRegistry("photo-contexts-models")).then(function(n){var r=n[0],s=n[1],o=n[2],u=n[3],a=n[4],f,l;if(r.stat==="ok")return s&&!s.hasPhoto(o.getValue("id"))&&(s.addPhoto(o),o.getValue("isVideo")?s.setValue("videoCount",s.getValue("videoCount")+1):s.setValue("photoCount",s.getValue("photoCount")+1),1===s.getValue("photoCount")+s.getValue("videoCount")&&(f=o.getValue("sizes"),l={},e.Object.each(f,function(e,t){["m","s","sq","t"].indexOf(t)>-1&&(l[t]={width:e.width,height:e.height,src:e.url})}),s.setValue("primary",i),s.setValue("primaryPhotoSizes",l))),u.exists(t.photoID)&&!u.getValue(t.photoID,"galleries").getFromListByID(s.getValue("id"))&&(u.getValue(t.photoID,"galleries").prependToList(s),u.setValue(t.photoID,"total",u.getValue(t.photoID,"total")+1)),a.exists(t.photoID)&&!a.getValue(t.photoID,"contexts").getFromListByID(s.getValue("id"))&&(a.setValue(t.photoID,"totalGalleries",a.getValue(t.photoID,"totalGalleries")+1),a.getValue(t.photoID,"contexts").appendToList(s)),s},function(e){throw n[e.fatal?"error":"debug"]("[flickr-galleries-addPhoto-creator] failed getting or processing API response:",e),e})}e.namespace("ModelCreators")["flickr-galleries-addPhoto"]={run:t}},"@VERSION@",{requires:["flickr-promise"],optional:["gallery-models","photo-models","photo-galleries-models","photo-contexts-models"]});
YUI.add("flickr-galleries-removePhoto-deletor",function(e){"use strict";function t(t,n){var r={},i=t.galleryCompoundID.split("-")[1];return r.photo_id=t.photoID,r.gallery_id=t.galleryCompoundID,e.batch(n.callAPI("flickr.galleries.removePhoto",r),n.getModel("gallery-models",i),n.getModel("photo-models",t.photoID),n.getModelRegistry("photo-galleries-models"),n.getModelRegistry("photo-contexts-models")).then(function(e){var n=e[0],r=e[1],s=e[2],o=e[3],u=e[4];if(n.stat==="ok")return u.exists(t.photoID)&&u.getValue(t.photoID,"contexts").getFromListByID(i)&&(u.setValue(t.photoID,"totalGalleries",u.getValue(t.photoID,"totalGalleries")-1),u.getValue(t.photoID,"contexts").removeFromList(i)),o.exists(t.photoID)&&o.getValue(t.photoID,"galleries").getFromListByID(i)&&(o.setValue(t.photoID,"total",o.getValue(t.photoID,"total")-1),o.getValue(t.photoID,"galleries").removeFromList(i)),r&&(r.hasPhoto(s.getValue("id"))&&r.removePhoto(s),s.getValue("isVideo")?r.setValue("videoCount",r.getValue("videoCount")-1):r.setValue("photoCount",r.getValue("photoCount")-1),0===r.getValue("photoCount")+r.getValue("videoCount")&&(r.setValue("primary",null),r.setValue("primaryPhotoSizes",{}))),r},function(e){throw n[e.fatal?"error":"debug"]("[flickr-galleries-removePhoto-deletor] failed getting or processing API response:",e),e})}e.namespace("ModelCreators")["flickr-galleries-removePhoto"]={run:t}},"@VERSION@",{requires:["flickr-promise"],optional:["gallery-models","photo-models","photo-galleries-models","photo-contexts-models"]});
YUI.add("flickr-galleries-getList-fetcher",function(e){"use strict";function t(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=r.galleries,a=n.id,f,l={},c=[];u&&(f=o.exists(a)?o.proxy(a):o.add(a),u.gallery&&e.Array.each(u.gallery,function(t,n){var r,i,o;i=t.id.split("-")[1],o={id:i,compoundId:t.id,title:t.title.content,description:t.description.content,owner:f,primary:t.primaryPhotoId,primaryPhotoSizes:e.APIHelper.response.parsePrimaryPhotoSizes(t),photoCount:t.countPhotos,videoCount:t.countVideos},r=s.exists(i)?s.proxy(i):s.add(o),c.push(r)}),l={id:a,galleries:c},i.exists(a)?i.setValues(a,l):i.add(l))}function n(t,n){var r=this,i={user_id:t.id,primary_photo_extras:"url_sq, url_t, url_s, url_m"};return e.batch(n.callAPI("flickr.galleries.getList",i),n.getModelRegistry("person-galleries-models"),n.getModelRegistry("gallery-models"),n.getModelRegistry("person-models")).then(function(e){r._processResponse(e,t)},function(e){throw n[e.fatal?"error":"debug"]("[flickr-galleries-getList-fetcher] failed getting or processing API response:",e),e})}e.namespace("ListFetchers")["flickr-galleries-getList"]={run:n,_processResponse:t}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["person-galleries-models","gallery-models","person-models"]});
YUI.add("person-galleries-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-galleries-getList"].run(t,this.appContext)}},attributes:{id:{},galleries:{isListProxy:!0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-galleries-getList-fetcher"]});
YUI.add("flickr-galleries-create-creator",function(e){"use strict";function t(t,n){var r={};return r.title=t.title,r.description=t.description,r.primary_photo_id=t.photoID,r.full_result=1,e.batch(n.callAPI("flickr.galleries.create",r),n.getModelRegistry("gallery-models"),n.getModel("photo-models",t.photoID),n.getModel("person-models",n.getViewer().nsid),n.getModel("person-galleries-models",n.getViewer().nsid),n.getModelRegistry("photo-galleries-models"),n.getModelRegistry("photo-contexts-models")).then(function(n){var r=n[0],i=n[1],s=n[2],o=n[3],u=n[4],a=n[5],f=n[6],l,c=r.gallery.id,h=c.split("-")[1];return h?(l=i.add({id:h,compoundId:c,title:r.gallery.title.content,description:r.gallery.description.content,photoPageList:[s],photoContextList:[s],owner:o,primary:t.photoID,primaryPhotoSizes:e.APIHelper.response.parsePrimaryPhotoSizes(r.gallery),photoCount:s.getValue("isVideo")?0:1,videoCount:s.getValue("isVideo")?1:0}),u.getValue("galleries").prependToList(l),a.exists(t.photoID)&&!a.getValue(t.photoID,"galleries").getFromListByID(l.getValue("id"))&&(a.getValue(t.photoID,"galleries").prependToList(l),a.setValue(t.photoID,"total",a.getValue(t.photoID,"total")+1)),f.exists(t.photoID)&&!f.getValue(t.photoID,"contexts").getFromListByID(l.getValue("id"))&&(f.setValue(t.photoID,"totalGalleries",f.getValue(t.photoID,"totalGalleries")+1),f.getValue(t.photoID,"contexts").appendToList(l)),l):!1},function(e){throw n[e.fatal?"error":"debug"]("[flickr-galleries-create-creator] failed getting or processing API response:",e),e})}e.namespace("ModelCreators")["flickr-galleries-create"]={run:t}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["gallery-models","photo-models","person-models","person-galleries-models","photo-galleries-models","photo-contexts-models"]});
YUI.add("gallery-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{langBundles:this.details.langBundles,name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-galleries-getPhotos"].run(t,this.appContext)},create:function(t,n){return e.ModelCreators["flickr-galleries-create"].run(t,n)},addPhoto:function(t,n){return e.ModelCreators["flickr-galleries-addPhoto"].run(t,n)},removePhoto:function(t,n){return e.ModelCreators["flickr-galleries-removePhoto"].run(t,n)}},addPhoto:function(e,t){return this.getValue(e,"photoPageList").hasMaxBoundary()&&this.getValue(e,"photoPageList").appendToList(t),this.getValue(e,"photoContextList").hasMaxBoundary()&&this.getValue(e,"photoContextList").appendToList(t),this},removePhoto:function(e,t){return this.getValue(e,"photoPageList").removeFromList(t.getValue("id")),this.getValue(e,"photoContextList").removeFromList(t.getValue("id")),this},hasPhoto:function(e,t){return this.getValue(e,"photoPageList").getFromListByID(t)||this.getValue(e,"photoContextList").getFromListByID(t)},attributes:{compoundId:{validator:function(t,n){return e.Lang.isString(t)&&t.indexOf("-")>-1}},displayType:{readOnly:!0,defaultFn:function(){return"gallery"}},title:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){var n=e.AttributeHelpers.coerceString(t);return n=n.replace(/\\'/,"'").replace(/\\"/,'"').replace(/\\\\/,"\\"),n},defaultValue:""},description:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},owner:{isModel:!0},photoPageList:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-galleries-getPhotos"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:e.ListFetchers["flickr-galleries-getContext"],listItemIdField:"photoId"}},photoCount:{validator:function(t,n){return e.AttributeHelpers.validateInteger(t)},setter:function(t,n){return e.AttributeHelpers.coerceInteger(t)}},videoCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},photoCountDisplay:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){var t=this.getValue(e,"photoCount"),n=this.getValue(e,"videoCount"),r="";return t-=n,t===0&&n===0?r=this.intlMessage({intlName:"models.ZERO_PHOTOS"}):t===1&&n===0?r=this.intlMessage({intlName:"models.ONE_PHOTO"}):t>1&&n===0?r=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS",photos:t}):t===0&&n===1?r=this.intlMessage({intlName:"models.ONE_VIDEO"}):t===1&&n===1?r=this.intlMessage({intlName:"models.ONE_PHOTO_AND_ONE_VIDEO"}):t>1&&n===1?r=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_ONE_VIDEO",photos:t}):t===0&&n>1?r=this.intlMessage({intlName:"models.MULTIPLE_VIDEOS",videos:n}):t===1&&n>1?r=this.intlMessage({intlName:"models.ONE_PHOTO_AND_MULTIPLE_VIDEOS",videos:n}):t>1&&n>1&&(r=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_MULTIPLE_VIDEOS",photos:t,videos:n})),r}},primary:{},primaryPhotoSizes:{},bestIconURL:{readOnly:!0,derivedBy:["primaryPhotoSizes"],defaultFn:function(e){var t=this.getValue(e,"primaryPhotoSizes");return t&&t.sq?t.sq.src:undefined}},url:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){var t=this.getValue(e,"owner");return t?"/photos/"+t.getValue("pathAlias")+"/galleries/"+e+"/":undefined}},urlSuffix:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){var t=this.getValue(e,"owner"),n=t.getValue("pathAlias");return"gallery-"+n+"-"+e}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-galleries-getPhotos-fetcher","flickr-galleries-getContext-fetcher","flickr-galleries-addPhoto-creator","flickr-galleries-removePhoto-deletor","flickr-galleries-create-creator"],langBundles:["models"]});
YUI.add("photo-groups-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getAllContexts"].run(t,this.appContext)}},attributes:{id:{},groups:{isListProxy:!0},total:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0}}})},"@VERSION@",{requires:["api-helper","flickr-model-registry","flickr-promise","flickr-photos-getAllContexts-fetcher"]});
YUI.add("photo-sets-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getAllContexts"].run(t,this.appContext)}},attributes:{id:{},sets:{isListProxy:!0},total:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0}}})},"@VERSION@",{requires:["api-helper","flickr-model-registry","flickr-promise","flickr-photos-getAllContexts-fetcher"]});
YUI.add("flickr-photosets-addPhoto-creator",function(e){"use strict";function t(t,n){var r={};return r.photo_id=t.photoID,r.photoset_id=t.setID,e.batch(n.callAPI("flickr.photosets.addPhoto",r),n.getModel("set-models",t.setID),n.getModel("photo-models",t.photoID),n.getModelRegistry("photo-sets-models"),n.getModelRegistry("photo-contexts-models")).then(function(e){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4];if(n.stat==="ok")return r&&!r.hasPhoto(i.getValue("id"))&&(r.addPhoto(i),i.getValue("isVideo")?r.setValue("videoCount",r.getValue("videoCount")+1):r.setValue("photoCount",r.getValue("photoCount")+1)),s.exists(t.photoID)&&!s.getValue(t.photoID,"sets").getFromListByID(r.getValue("id"))&&(s.getValue(t.photoID,"sets").prependToList(r),s.setValue(t.photoID,"total",s.getValue(t.photoID,"total")+1)),o.exists(t.photoID)&&!o.getValue(t.photoID,"contexts").getFromListByID(r.getValue("id"))&&(o.setValue(t.photoID,"totalSets",o.getValue(t.photoID,"totalSets")+1),o.getValue(t.photoID,"contexts").appendToList(r)),r},function(e){throw n[e.fatal?"error":"debug"]("[flickr-photosets-addPhoto-creator] failed getting or processing API response:",e),e})}e.namespace("ModelCreators")["flickr-photosets-addPhoto"]={run:t}},"@VERSION@",{requires:["flickr-promise"],optional:["set-models","photo-models","photo-sets-models","photo-contexts-models"]});
YUI.add("flickr-photosets-getList-fetcher",function(e){"use strict";function t(e){var t={user_id:e.id,primary_photo_extras:"url_sq, url_t, url_s, url_m",page:e.page||1,per_page:e.perPage||500};return t}function n(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=r.photosets,a=n.id,f,l={},c=[];if(u)return f=o.exists(a)?o.proxy(a):o.add({id:a}),u.photoset&&e.Array.each(u.photoset,function(t,n){var r,i={id:t.id,title:t.title.content,owner:f,primary:t.primary,primaryPhotoSizes:e.APIHelper.response.parsePrimaryPhotoSizes(t),isAutoUploadSet:t.autoUpload,photoCount:t.photos,videoCount:t.videos};r=s.exists(t.id)?s.proxy(t.id):s.add(i),c.push(r)}),l={id:a},l.sets=e.APIHelper.response.addOrReplaceListByPage({current:i.exists(a)?i.proxy(a).getValue("sets").getList():[],perPage:n.perPage,pageNum:n.page,hasMin:!1,hasMax:!1,totalItems:r.photosets.total,newPages:c}),i.exists(a)?i.setValue(a,"sets",l.sets):i.add(l),l.sets}function r(t,n){var r=this,i=this._processParams(t);return e.batch(n.callAPI("flickr.photosets.getList",i,!0),n.getModelRegistry("sets-models"),n.getModelRegistry("set-models"),n.getModelRegistry("person-models")).then(function(e){return t.perPage=i.per_page,t.page=i.page,r._processResponse(e,t)},function(e){throw n[e.fatal?"error":"debug"]("[flickr-photosets-getList-fetcher] failed getting or processing API response:",e),e})}e.namespace("ListFetchers")["flickr-photosets-getList"]={run:r,_processParams:t,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["sets-models","set-models","person-models"]});
YUI.add("sets-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-photosets-getList"].run(t,this.appContext)}},attributes:{id:{},sets:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-photosets-getList"]}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photosets-getList-fetcher"]});
YUI.add("flickr-photosets-removePhoto-deletor",function(e){"use strict";function t(t,n){var r={};return r.photo_id=t.photoID,r.photoset_id=t.setID,e.batch(n.callAPI("flickr.photosets.removePhoto",r),n.getModel("set-models",t.setID),n.getModel("photo-models",t.photoID),n.getModel("sets-models",n.getViewer().nsid),n.getModelRegistry("photo-sets-models"),n.getModelRegistry("photo-contexts-models")).then(function(e){var n=e[0],r=e[1],i=e[3],s=e[2],o=e[4],u=e[5];if(n.stat==="ok"){u.exists(t.photoID)&&u.getValue(t.photoID,"contexts").getFromListByID(t.setID)&&(u.setValue(t.photoID,"totalSets",u.getValue(t.photoID,"totalSets")-1),u.getValue(t.photoID,"contexts").removeFromList(t.setID)),o.exists(t.photoID)&&o.getValue(t.photoID,"sets").getFromListByID(t.setID)&&(o.setValue(t.photoID,"total",o.getValue(t.photoID,"total")-1),o.getValue(t.photoID,"sets").removeFromList(t.setID));if(r){r.hasPhoto(s.getValue("id"))&&r.removePhoto(s),s.getValue("isVideo")?r.setValue("videoCount",r.getValue("videoCount")-1):r.setValue("photoCount",r.getValue("photoCount")-1);if(r.getValue("photoCount")<1&&r.getValue("videoCount")<1)return i.getValue("sets").removeFromList(t.setID),r.registry.remove(t.setID),null}return r}},function(e){throw n[e.fatal?"error":"debug"]("[flickr-photosets-removePhoto-deletor] failed getting or processing API response:",e),e})}e.namespace("ModelCreators")["flickr-photosets-removePhoto"]={run:t}},"@VERSION@",{requires:["flickr-promise"],optional:["set-models","photo-models","sets-models","photo-sets-models","photo-contexts-models"]});
YUI.add("flickr-photosets-getPhotos-fetcher",function(e){"use strict";function t(t){t.page=t.page||1,t.perPage=t.perPage||100;var n={photoset_id:t.id,extras:e.APIHelper.request.getRebootPhotoExtras(),per_page:t.perPage,page:t.page,get_user_info:1,primary_photo_extras:"url_sq, url_t, url_s, url_m"};return n}function n(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f,l,c,h,p,d=[],v=!1,m=!1;return f=e.APIHelper.response.parsePerson(r.user),l=s.exists(f.id)?s.proxy(f.id):s.add(f),c={id:n.id,title:r.photoset.title,owner:l,primary:r.photoset.primary,primaryPhotoSizes:e.APIHelper.response.parsePrimaryPhotoSizes(r.photoset),isAutoUploadSet:r.photoset.isAutoUploadSet,photoCount:r.photoset.photoCount,videoCount:r.photoset.videoCount,photoList:[]},o.exists(n.id)&&(h=o.getValue(n.id,"photoPageList"),v=h.hasMinBoundary?h.hasMinBoundary():!1,m=h.hasMaxBoundary?h.hasMaxBoundary():!1,d=h.getList()),p=e.APIHelper.response.parsePhotos({photos:r.photoset.photo,ownerID:r.photoset.owner,personModelRegistry:s,photoModelRegistry:i,photoEngagementModelRegistry:u,photoStatsModelRegistry:a}),c.photoPageList=e.APIHelper.response.addOrReplaceListByPage({current:d,perPage:n.perPage,pageNum:n.page,hasMax:m,hasMin:v,totalItems:r.photoset.total,newPages:p}),c.photoList.length&&(c.primary=r.photoset.primary),c.photoCount=r.photoset.total,o.exists(c.id)?o.setValue(n.id,"photoPageList",c.photoPageList):o.add(c),p}function r(t,n){var r=this;return e.batch(n.callAPI("flickr.photosets.getPhotos",this._processParams(t),!0),n.getModelRegistry("photo-models"),n.getModelRegistry("person-models"),n.getModelRegistry("set-models"),n.getModelRegistry("photo-engagement-models"),n.getModelRegistry("photo-stats-models")).then(function(e){return r._processResponse(e,t)},function(e){throw n[e.fatal?"error":"debug"]("[flickr-photosets-getPhotos-fetcher] failed getting or processing API response:",e),e})}e.namespace("ListFetchers")["flickr-photosets-getPhotos"]={run:r,_processParams:t,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models","person-models","set-models","photo-engagement-models","photo-stats-models"]});
YUI.add("flickr-photosets-getContext-fetcher",function(e){"use strict";function t(t,n){var r={photoset_id:t.id,extras:e.APIHelper.request.getRebootPhotoExtras(),photo_id:t.photoId,num_prev:t.numPrev,num_next:t.numNext,get_photoset_info:1};return r}function n(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=[],l=[],c=s.proxy(n.photoId),h,p,d,v,m,g,y=[];return h=r.prevphotos,p=r.nextphotos,l=e.APIHelper.response.parsePhotos({photos:h.photo,personModelRegistry:o,photoModelRegistry:s,photoEngagementModelRegistry:u,photoStatsModelRegistry:a}),f=e.APIHelper.response.parsePhotos({photos:p.photo,personModelRegistry:o,photoModelRegistry:s,photoEngagementModelRegistry:u,photoStatsModelRegistry:a}),m=i.getValue(n.id,"photoContextList"),d=m.hasMinBoundary?m.hasMinBoundary():!1,v=m.hasMaxBoundary?m.hasMaxBoundary():!1,g=m.getList(),y=e.APIHelper.response.addOrReplaceListByContext({model:c,next:l,prev:f.reverse(),current:g,hasMin:d,hasMax:v,numNext:n.numPrev,numPrev:n.numNext}),i.setValue(n.id,"photoContextList",y),{next:l,previous:f.reverse()}}function r(t,n){var r=this;return e.batch(n.callAPI("flickr.photosets.getContext",this._processParams(t,n),!0),n.getModelRegistry("set-models"),n.getModelRegistry("photo-models"),n.getModelRegistry("person-models"),n.getModelRegistry("photo-stats-models"),n.getModelRegistry("photo-engagement-models")).then(function(e){return r._processResponse(e,t)},function(e){throw n[e.fatal?"error":"debug"]("[flickr-photosets-getContext-fetcher] failed getting or processing API response:",e),e.code===2&&e.message==="Photo not in set"&&(e.notInContext=!0),e})}e.namespace("ListFetchers")["flickr-photosets-getContext"]={run:r,_processParams:t,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["set-models","photo-models","person-models","photo-engagement-models","photo-stats-models"]});
YUI.add("flickr-photosets-create-creator",function(e){"use strict";function t(t,n){var r={};return r.title=t.title,r.description=t.description,r.primary_photo_id=t.photoID,r.full_result=1,e.batch(n.callAPI("flickr.photosets.create",r),n.getModelRegistry("set-models"),n.getModel("photo-models",t.photoID),n.getModel("person-models",n.getViewer().nsid),n.getModel("sets-models",n.getViewer().nsid),n.getModelRegistry("photo-sets-models"),n.getModelRegistry("photo-contexts-models")).then(function(n){var r=n[0],i=n[1],s=n[2],o=n[3],u=n[4],a=n[5],f=n[6],l;return r.photoset.id?(l=i.add({id:r.photoset.id,title:r.photoset.title.content,photoPageList:[s],photoContextList:[s],owner:o,primary:r.primary,primaryPhotoSizes:e.APIHelper.response.parsePrimaryPhotoSizes(r.photoset),isAutoUploadSet:!1,photoCount:r.photoset.photos,videoCount:r.photoset.videos}),u.getValue("sets").prependToList(l),a.exists(t.photoID)&&!a.getValue(t.photoID,"sets").getFromListByID(l.getValue("id"))&&(a.getValue(t.photoID,"sets").prependToList(l),a.setValue(t.photoID,"total",a.getValue(t.photoID,"total")+1)),f.exists(t.photoID)&&!f.getValue(t.photoID,"contexts").getFromListByID(l.getValue("id"))&&(f.setValue(t.photoID,"totalSets",f.getValue(t.photoID,"totalSets")+1),f.getValue(t.photoID,"contexts").appendToList(l)),l):!1},function(e){throw n[e.fatal?"error":"debug"]("[flickr-photosets-create-creator] failed getting or processing API response:",e),e})}e.namespace("ModelCreators")["flickr-photosets-create"]={run:t}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["set-models","photo-models","person-models","sets-models","photo-sets-models","photo-contexts-models"]});
YUI.add("set-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{langBundles:this.details.langBundles,name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-photosets-getPhotos"].run(t,this.appContext)},create:function(t,n){return e.ModelCreators["flickr-photosets-create"].run(t,n)},addPhoto:function(t,n){return e.ModelCreators["flickr-photosets-addPhoto"].run(t,n)},removePhoto:function(t,n){return e.ModelCreators["flickr-photosets-removePhoto"].run(t,n)}},addPhoto:function(e,t){return this.getValue(e,"photoPageList").hasMaxBoundary()&&this.getValue(e,"photoPageList").appendToList(t),this.getValue(e,"photoContextList").hasMaxBoundary()&&this.getValue(e,"photoContextList").appendToList(t),this},removePhoto:function(e,t){return this.getValue(e,"photoPageList").removeFromList(t.getValue("id")),this.getValue(e,"photoContextList").removeFromList(t.getValue("id")),this},hasPhoto:function(e,t){return this.getValue(e,"photoPageList").getFromListByID(t)||this.getValue(e,"photoContextList").getFromListByID(t)},attributes:{displayType:{readOnly:!0,defaultFn:function(){return"set"}},title:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},owner:{isModel:!0},photoPageList:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-photosets-getPhotos"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:e.ListFetchers["flickr-photosets-getContext"],listItemIdField:"photoId"}},photoCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},videoCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},photoCountDisplay:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){var t=this.getValue(e,"photoCount"),n=this.getValue(e,"videoCount"),r="";return t-=n,t===0&&n===0?r=this.intlMessage({intlName:"models.ZERO_PHOTOS"}):t===1&&n===0?r=this.intlMessage({intlName:"models.ONE_PHOTO"}):t>1&&n===0?r=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS",photos:t}):t===0&&n===1?r=this.intlMessage({intlName:"models.ONE_VIDEO"}):t===1&&n===1?r=this.intlMessage({intlName:"models.ONE_PHOTO_AND_ONE_VIDEO"}):t>1&&n===1?r=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_ONE_VIDEO",photos:t}):t===0&&n>1?r=this.intlMessage({intlName:"models.MULTIPLE_VIDEOS",videos:n}):t===1&&n>1?r=this.intlMessage({intlName:"models.ONE_PHOTO_AND_MULTIPLE_VIDEOS",videos:n}):t>1&&n>1&&(r=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_MULTIPLE_VIDEOS",photos:t,videos:n})),r}},primary:{},primaryPhotoSizes:{},bestIconURL:{readOnly:!0,derivedBy:["primaryPhotoSizes"],defaultFn:function(e){var t=this.getValue(e,"primaryPhotoSizes");return t.sq?t.sq.src:undefined}},url:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){var t=this.getValue(e,"owner");return t?"/photos/"+t.getValue("pathAlias")+"/sets/"+e:undefined}},isAutoUploadSet:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},urlSuffix:{readOnly:!0,defaultFn:function(e){return"set-"+e}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photosets-addPhoto-creator","flickr-photosets-removePhoto-deletor","flickr-photosets-getPhotos-fetcher","flickr-photosets-getContext-fetcher","flickr-photosets-create-creator"],langBundles:["models"]});
YUI.add("flickr-photos-getAllContexts-fetcher",function(e){"use strict";function t(t){var n={photo_id:t.id,extras:e.APIHelper.request.getRebootPhotoExtras()+","+e.APIHelper.request.getRebootGroupExtras(),primary_photo_extras:"url_sq, url_t, url_s, url_m"};return t.scrappy&&(n.get_all_galleries=1,n.no_faves_context=1,n.per_type_limit=6,n.get_totals=1,n.sort="date-desc"),n}function n(t,n){var r=t[0],i=t[1],s=t[2],o={},u=[],a,f=t[8],l=t[9],c=t[10],h=t[11];return o.faves=t[3],o.gallery=t[4],o.pool=t[5],o.set=t[6],o.stream=t[7],e.Object.each(o,function(t,n){r[n]&&e.Array.each(r[n],function(n){e.APIHelper.response.addContextToRegistry(n,t,i,h),u.push(t.proxy(n.id))})}),s.exists(n.id)||(a=s.add({id:n.id,totalGroups:r.totals&&r.totals.groups,totalSets:r.totals&&r.totals.sets,totalGalleries:r.totals&&r.totals.galleries}),s.setValue(n.id,"contexts",u)),f.exists(n.id)||f.add({id:n.id,total:r.totals&&r.totals.groups,groups:s.getContextsOfType(n.id,"group-pool-models")}),l.exists(n.id)||l.add({id:n.id,total:r.totals&&r.totals.sets,sets:s.getContextsOfType(n.id,"set-models")}),c.exists(n.id)||c.add({id:n.id,total:r.totals&&r.totals.galleries,galleries:s.getContextsOfType(n.id,"gallery-models")}),a}function r(t,n){var r=this;return n.flipper.isFlipped("enable-scrappy-photo-page")&&(t.scrappy=!0),e.batch(n.callAPI("flickr.photos.getAllContexts",this._processParams(t),!0),n.getModelRegistry("person-models"),n.getModelRegistry("photo-contexts-models"),n.getModelRegistry("favorite-models"),n.getModelRegistry("gallery-models"),n.getModelRegistry("group-pool-models"),n.getModelRegistry("set-models"),n.getModelRegistry("photostream-models"),n.getModelRegistry("photo-groups-models"),n.getModelRegistry("photo-sets-models"),n.getModelRegistry("photo-galleries-models"),n.getModelRegistry("group-models")).then(function(e){return r._processResponse(e,t)},function(e){throw n[e.fatal?"error":"debug"]("[flickr-photos-getAllContexts-fetcher] failed getting or processing API response:",e),e})}e.namespace("ModelFetchers")["flickr-photos-getAllContexts"]={run:r,_processParams:t,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-contexts-models","favorite-models","gallery-models","group-pool-models","photostream-models","set-models","photo-groups-models","photo-sets-models","photo-galleries-models","group-models"]});
YUI.add("photo-contexts-models",function(e){function t(e){t.superclass.constructor.call(this,e),this.getMorePromises={"group-pool-models":{},"set-models":{},"gallery-models":{}},this.continuationKeys={"group-pool-models":{},"set-models":{},"gallery-models":{}}}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return this.appContext.flipper.isFlipped("enable-scrappy-photo-page")?e.ModelFetchers["flickr-photos-getAllContexts"].run(t,this.appContext):e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext)}},getMoreContextsOfType:function(t,n,r){var i=this,s,o,u,a,f,l,c,h="-1",p=e.APIHelper.request.getRebootPhotoExtras();switch(n){case"group-pool-models":s="flickr.photos.getGroups",u="groups.group",p+=","+e.APIHelper.request.getRebootGroupExtras();break;case"set-models":s="flickr.photos.getSets",u="sets.set";break;case"gallery-models":s="flickr.photos.getGalleries",u="galleries.gallery"}return s?this.exists(t)?(a=this.continuationKeys[n][t]||"0",a===h?new e.AutoResolvingPromise({type:n,newContexts:[],loadedAll:!0}):(o={photo_id:t,extras:p,primary_photo_extras:"url_sq, url_t, url_s, url_m",continuation:a,per_page:r},l=t+"_"+a,c=this.getMorePromises[n][l],c?c:(this.getMorePromises[n][l]=(new e.FlickrPromise({apiResponse:this.appContext.callAPI(s,o,!0),contextRegistry:this.appContext.getModelRegistry(n),personRegistry:this.appContext.getModelRegistry("person-models")})).then(function(r){var s=[],o=r.apiResponse,a=r.contextRegistry,c=r.personRegistry,p,d,v;return d=u.split(".").reduce(function(t,n){return e.Lang.isObject(t)?t[n]:undefined},o),d&&(e.Array.each(d,function(t){e.APIHelper.response.addContextToRegistry(t,a,c),s.push(a.proxy(t.id))}),s.length&&(v=i.getContextsOfType(t,n).map(function(e){return e.getValue("id")}),s=s.filter(function(e){return v.indexOf(e.getValue("id"))===-1}),s.length&&i.getValue(t,"contexts").appendToListMulti(s))),f=o.continuation,typeof f=="undefined"?f=h:e.Lang.isNumber(f)&&(f+=""),p=f===h,i.continuationKeys[n][t]=f,delete i.getMorePromises[n][l],{type:n,newContexts:s,loadedAll:p}}),this.getMorePromises[n][l]))):new e.AutoRejectingPromise("[photo-contexts-models] getMoreContextsOfType was called for an ID that isn't in the registry: "+t):new e.AutoRejectingPromise("[photo-contexts-models] getMoreContextsOfType was called without an invalid type: "+n)},getContextsOfType:function(t,n){return n=e.Array(n),this.getValue(t,"contexts").getList().filter(function(e){return n.indexOf(e.registry.name)>-1})},getContextsNotOfType:function(t,n){return n=e.Array(n),this.getValue(t,"contexts").getList().filter(function(e){return n.indexOf(e.registry.name)===-1})},attributes:{contexts:{isListProxy:!0},totalGroups:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},totalSets:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},totalGalleries:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0}}})},"@VERSION@",{requires:["api-helper","flickr-model-registry","flickr-promise","flickr-photos-getInfo-fetcher","flickr-photos-getAllContexts-fetcher"]});
